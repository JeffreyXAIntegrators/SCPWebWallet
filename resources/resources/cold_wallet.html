<!DOCTYPE html>
<html>
  <head>
    <title>ScPrime Web Wallet</title>
    <meta http-equiv="PRAGMA" content="NO-CACHE">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
  </head>
  <body id="coldWallet">
    <h1 class="center">ScPrime</h1>
    <h2 class="center">Cold Wallet</h2>
    <div id="content" class="pad center">
        Loading...
    </div>
    <style>
&STYLE;
    </style>
    <script>
      function displayStartupMenu() {
        document.getElementById('content').innerHTML = `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='displayUnlockWallet()'>Unlock Existing</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='displayRestoreFromSeed()'>Restore From Seed</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='displayNewWallet()'>Create New Wallet</button></div>`
      }
      function displayNewWallet() {
	displayWallet(newWalletSeed())
      }
      function displayRestoreFromSeed() {
        document.getElementById('content').innerHTML = `<div class='pad'><button onclick='displayStartupMenu()'>Close</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Seed:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'><input type="password" id="restoreThisSeed"></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='displayWallet(document.getElementById("restoreThisSeed").value)'>Restore</button></div>`
      }
      function displayWallet(aSeed) {
        seed = aSeed
        address = addressFromSeed(seed).toLowerCase()
        document.getElementById('content').innerHTML = `<div class='pad'><button onclick='displaySaveThisWallet()'>Save</button> <button onclick='displayStartupMenu()'>Close</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Seed:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'>${seed} <font id='copiedSeedIcon'></font></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='copySeedToClipboard()'>Copy</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Receive Coins At:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'>${address} <font id='copiedAddressIcon'></font></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick="copyAddressToClipboard()">Copy</button></div>`  
      }
      function displaySaveThisWallet() {
        document.getElementById('content').innerHTML = `<div class='pad'><button onclick='displayStartupMenu()'>Close</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Wallet Name:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'><input type="text" id="saveThisWalletName"></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Wallet Password:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'><input type="password" id="saveThisWalletPass"></div>`
	      document.getElementById('content').innerHTML += `<div class='pad'><button onclick='saveThisWallet(document.getElementById("saveThisWalletName").value, document.getElementById("saveThisWalletPass").value, "${seed}")'>Save</button></div>`
      }
      function saveThisWallet(aName, aPass, aSeed) {
        localStorage.setItem(aName + '~~~~' + aPass, aSeed)
	displayWallet(seed)
      }
      function displayUnlockWallet() {
        document.getElementById('content').innerHTML = `<div class='pad'><button onclick='displayStartupMenu()'>Close</button></div>`
        document.getElementById('content').innerHTML += `<div class='pad dashed'></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Wallet Name:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'><input type="text" id="unlockThisWalletName"></div>`
        document.getElementById('content').innerHTML += `<div class='pad'>Wallet Password:</div>`
        document.getElementById('content').innerHTML += `<div class='pad'><input type="password" id="unlockThisWalletPass"></div>`
        document.getElementById('content').innerHTML += `<div class='pad'><button onclick='unlockThisWallet(document.getElementById("unlockThisWalletName").value, document.getElementById("unlockThisWalletPass").value)'>Unlock</button></div>`
      }
      function unlockThisWallet(aName, aPass) {
        seed = localStorage.getItem(aName + '~~~~' + aPass)
        displayWallet(seed)
      }
      function addCopiedAddressIcon() {
        document.getElementById('copiedAddressIcon').innerHTML = 'üñ®Ô∏è'
      }
      function addCopiedSeedIcon() {
        document.getElementById('copiedSeedIcon').innerHTML = 'üñ®Ô∏è'
      }
      function removeCopiedAddressIcon() {
        document.getElementById('copiedAddressIcon').innerHTML = ''
      }
      function removeCopiedSeedIcon() {
        document.getElementById('copiedSeedIcon').innerHTML = ''
      }
      function copyAddressToClipboard() {
        copyToClipboard(address)
        addCopiedAddressIcon()
        removeCopiedSeedIcon()
      }
      function copySeedToClipboard() {
        copyToClipboard(seed)
        removeCopiedAddressIcon()
        addCopiedSeedIcon()
      }
      var address
      var seed
    </script>
    <script>
&SCRIPT;
    </script>
    <script>
&WASM_EXEC;
    </script>
    <script>
      const go = new Go();
      WebAssembly.instantiateStreaming(fetch("data:application/wasm;base64,&WALLET_WASM;"), go.importObject).then((result) => {
        go.run(result.instance);
	displayStartupMenu()
      })
    </script>
  </body>
</html>

